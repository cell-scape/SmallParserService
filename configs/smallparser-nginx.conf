worker_processes 1;
user www-data;
error_log /var/log/nginx/error.log warn;
pid /var/run/nginx.pid;

events {
        worker_connections 1024;
        accept_mutex off;
        use epoll;
}

http {
        include mime.types;
        default_type application/octet-stream;
        access_log /var/log/nginx/access.log combined;
        sendfile on;

        upstream app_server {
                server unix:/tmp/gunicorn.sock fail_timeout=0;
        }

        server {
                listen 80 default_server;
                return 443;
        }

        server {
                listen 80 deferred;
                client_max_body_size 4G;
                server_name scientician.systems www.scientician.systems;
                keepalive_timeout 5;
                root /home/bradd/app/SmallParserService/static;
                location / {
                        try_files $uri @proxy_to_app;
                }

                location @proxy_to_app {
                        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
                        proxy_set_header X-Forwarded-Proto $scheme;
                        proxy_set_header Host $http_host;
                        proxy_redirect off;
                        proxy_pass http://app_server;
                }

                error_page 500 502 503 504 /500.html;
                location = /500.html {
                        root /home/bradd/app/SmallParserService/static;
                }
        }

        server {
                listen 443 ssl default_server;

                ssl_protocols SSLv3 TLSv1;

                ssl_ciphers ALL:!aNULL:!ADH:!eNULL:!LOW:!EXP:RC4+RSA:+HIGH:+MEDIUM;

                server_name scientician.systems www.scientician.systems;

                access_log /var/log/nginx/access.log;
                error_log  /var/log/nginx/error.log info;

                keepalive_timeout 75 75;

                ssl on;
                ssl_certificate /etc/ssl/certs/smallparser_selfsigned.crt;
                ssl_certificate_key /etc/ssl/private/smallparser_selfsigned.key;
                ssl_session_timeout  5m;

                root /home/bradd/app/SmallParserService/static;
                index index.html;
        }
}